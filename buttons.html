<!-- buttons.html -->
<div id="dynamic-buttons">

  <!-- ğŸ”— Boutons de partage -->
  <div class="share-bar" id="shareBar">
    <button class="share-btn" data-platform="facebook" title="Partager sur Facebook">ğŸ“˜</button>
    <button class="share-btn" data-platform="x" title="Partager sur X / Twitter">ğŸ¦</button>
    <button class="share-btn" data-platform="instagram" title="Partager sur Instagram">ğŸ“¸</button>
    <button class="share-btn" data-platform="linkedin" title="Partager sur LinkedIn">ğŸ’¼</button>
    <button class="share-btn" data-platform="snapchat" title="Partager sur Snapchat">ğŸ‘»</button>
    <button class="share-btn" data-platform="tiktok" title="Partager sur TikTok">ğŸµ</button>
    <button class="share-btn" data-platform="whatsapp" title="Partager sur WhatsApp">ğŸ’¬</button>
    <button class="share-btn" data-platform="telegram" title="Partager sur Telegram">ğŸ“¨</button>
    <button class="share-btn" data-platform="email" title="Partager par email">âœ‰ï¸</button>
    <button class="share-btn" id="copyText" title="Copier le texte">ğŸ“‹</button>
  </div>

  <!-- ğŸ’¬ Boutons de retour utilisateur -->
  <div class="feedback-buttons">
    <a id="btn-info" class="feedback-btn" href="#">Donner un complÃ©ment d'information</a>
    <a id="btn-error" class="feedback-btn" href="#">Signaler une erreur</a>
  </div>

</div>

<style>
/* === Styles importÃ©s depuis ton index === */

/* Partage */
.share-bar {
  margin-top: 14px;
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  justify-content: center;
  position: relative;
}
.share-btn {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: none;
  background: #fff;
  color: #111;
  font-size: 18px;
  cursor: pointer;
  position: relative;
  transition: transform 0.2s ease;
}
.share-btn:hover {
  transform: scale(1.15);
}
.share-btn[title]:hover::after {
  content: attr(title);
  position: absolute;
  bottom: -28px;
  left: 50%;
  transform: translateX(-50%);
  background: #111;
  color: #fff;
  padding: 4px 8px;
  border-radius: 6px;
  font-size: 12px;
  white-space: nowrap;
}

/* Feedback */
.feedback-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
  margin-top: 14px;
}

.feedback-btn {
  background: #c00;
  color: #fff;
  padding: 10px 14px;
  border-radius: 8px;
  font-size: 15px;
  text-decoration: none;
  font-weight: 500;
  transition: background 0.2s ease, transform 0.15s ease;
}

.feedback-btn:hover {
  background: #900;
  transform: scale(1.05);
}

.feedback-btn:active {
  transform: scale(0.97);
}
</style>

<script>
/* ===========================================
   ğŸŒ LIENS DE PARTAGE RÃ‰SEAUX SOCIAUX
=========================================== */
document.querySelectorAll('.share-btn[data-platform]').forEach(btn => {
  btn.addEventListener('click', async () => {
    const platform = btn.dataset.platform;
    const text = window.overlayText?.innerText || document.title;
    const url = window.location.href;
    const message = `${text}\n${url}`;
    const msg = encodeURIComponent(message);

    let shareUrl = '';
    switch (platform) {
      case 'facebook': shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}&quote=${msg}`; break;
      case 'x': shareUrl = `https://twitter.com/intent/tweet?text=${msg}`; break;
      case 'linkedin': shareUrl = `https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(url)}&title=${msg}`; break;
      case 'reddit': shareUrl = `https://www.reddit.com/submit?url=${encodeURIComponent(url)}&title=${msg}`; break;
      case 'whatsapp': shareUrl = `https://api.whatsapp.com/send?text=${msg}`; break;
      case 'telegram': shareUrl = `https://t.me/share/url?url=${encodeURIComponent(url)}&text=${msg}`; break;
      case 'email': shareUrl = `mailto:?subject=${encodeURIComponent('La roue de la servitude')}&body=${msg}`; break;
      default:
        alert('Partage non pris en charge pour ' + platform);
        return;
    }
    window.open(shareUrl, '_blank', 'noopener,noreferrer');
  });
});

/* ===========================================
   ğŸ§­ COPIER LE TEXTE
=========================================== */
const copyBtn = document.getElementById('copyText');
if (copyBtn) {
  copyBtn.addEventListener('click', async ()=>{
    try {
      const text = window.overlayText?.innerText || '';
      await navigator.clipboard.writeText(text);
      copyBtn.textContent = 'âœ…';
      setTimeout(()=>copyBtn.textContent='ğŸ“‹',1000);
    } catch(e){ alert('Impossible de copier le texte.'); }
  });
}

/* ===========================================
   ğŸ’¬ FEEDBACK â€” GITHUB DISCUSSIONS via NETLIFY
=========================================== */
const NETLIFY_FUNCTION_URL = "https://larouedelaservitude.netlify.app/.netlify/functions/sendFeedback";

function sendFeedbackToGitHub(resultText, userMessage, type) {
  fetch(NETLIFY_FUNCTION_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ resultText, userMessage, type })
  })
    .then(r => r.json())
    .then(data => {
      if (data.ok) {
        alert("âœ… Merci ! Votre retour a Ã©tÃ© envoyÃ©.");
        if (data.url) window.open(data.url, "_blank");
      } else {
        alert("âš ï¸ Erreur lors de lâ€™envoi : " + (data.error || 'Inconnue.'));
      }
    })
    .catch(err => {
      console.error(err);
      alert("âš ï¸ Une erreur est survenue.");
    });
}

document.getElementById('btn-info').addEventListener('click', e => {
  e.preventDefault();
  const userMsg = prompt("ğŸ’¬ Ajoutez votre complÃ©ment d'information :");
  if (userMsg) sendFeedbackToGitHub(window.overlayText?.innerText || '', userMsg, "info");
});

document.getElementById('btn-error').addEventListener('click', e => {
  e.preventDefault();
  const userMsg = prompt("âš ï¸ DÃ©crivez l'erreur trouvÃ©e :");
  if (userMsg) sendFeedbackToGitHub(window.overlayText?.innerText || '', userMsg, "error");
});
</script>
